<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Harita G√∂r√ºnt√ºleyici</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }

        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background: #2c3e50;
            color: white;
        }

        .sidebar-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }

        .search-box {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .search-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #3498db;
        }

        .room-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .room-category {
            margin-bottom: 15px;
        }

        .category-header {
            padding: 10px;
            background: #ecf0f1;
            font-weight: bold;
            color: #2c3e50;
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-header:hover {
            background: #d5dbdb;
        }

        .category-items {
            display: none;
        }

        .category-items.active {
            display: block;
        }

        .room-item {
            padding: 10px 15px;
            margin: 5px 0;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .room-item:hover {
            background: #3498db;
            color: white;
            transform: translateX(5px);
        }

        .room-item.selected {
            background: #2980b9;
            color: white;
        }

        .map-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #ecf0f1;
        }

        #svgContainer {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
        }

        #svgContainer.grabbing {
            cursor: grabbing;
        }

        #svgMap {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.3s ease;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #3498db;
            color: white;
            transform: scale(1.1);
        }

        .stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 12px;
        }

        .stats div {
            margin: 5px 0;
        }

        .arrow {
            display: inline-block;
            transition: transform 0.2s;
        }

        .arrow.down {
            transform: rotate(90deg);
        }

        /* Highlight style for selected rooms */
        .highlighted {
            filter: drop-shadow(0 0 10px #3498db);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                filter: drop-shadow(0 0 10px #3498db);
            }
            50% {
                filter: drop-shadow(0 0 20px #e74c3c);
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>üó∫Ô∏è Harita Birimleri</h1>
            <p>Birime tƒ±klayarak zoom yapƒ±n</p>
        </div>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Birim ara (√∂r: ID0054)...">
        </div>
        <div class="room-list" id="roomList">
            <!-- Room list will be populated by JavaScript -->
        </div>
    </div>

    <div class="map-container">
        <div id="svgContainer">
            <!-- SVG will be loaded here -->
        </div>
        <div class="controls">
            <button class="control-btn" id="zoomIn" title="Yakƒ±nla≈ütƒ±r">+</button>
            <button class="control-btn" id="zoomOut" title="Uzakla≈ütƒ±r">‚àí</button>
            <button class="control-btn" id="resetZoom" title="Sƒ±fƒ±rla">‚ü≤</button>
        </div>
        <div class="stats">
            <div><strong>Toplam Birim:</strong> <span id="totalRooms">0</span></div>
            <div><strong>Zoom:</strong> <span id="zoomLevel">100%</span></div>
        </div>
    </div>

    <script>
        let svgDoc = null;
        let currentZoom = 1;
        let selectedElement = null;
        let isPanning = false;
        let startPoint = { x: 0, y: 0 };
        let currentTranslate = { x: 0, y: 0 };

        // Load SVG
        async function loadSVG() {
            try {
                const response = await fetch('0.svg');
                const svgText = await response.text();
                const container = document.getElementById('svgContainer');
                container.innerHTML = svgText;
                svgDoc = container.querySelector('svg');
                
                if (svgDoc) {
                    svgDoc.id = 'svgMap';
                    svgDoc.style.width = '100%';
                    svgDoc.style.height = '100%';
                    extractRooms();
                    setupPanZoom();
                }
            } catch (error) {
                console.error('SVG y√ºklenirken hata:', error);
                alert('SVG dosyasƒ± y√ºklenemedi!');
            }
        }

        // Extract all rooms from SVG
        function extractRooms() {
            if (!svgDoc) return;

            const rooms = new Map();
            
            // Find all text elements that start with "ID"
            const textElements = svgDoc.querySelectorAll('text');
            
            textElements.forEach(textEl => {
                const tspans = textEl.querySelectorAll('tspan');
                tspans.forEach(tspan => {
                    const content = tspan.textContent.trim();
                    if (content.startsWith('ID')) {
                        // Extract base ID (without _1_, _2_, _3_ suffix)
                        const baseId = content.replace(/_\d+_$/, '');
                        
                        if (!rooms.has(baseId)) {
                            // Get position from text element
                            const x = parseFloat(textEl.getAttribute('x') || 0);
                            const y = parseFloat(textEl.getAttribute('y') || 0);
                            
                            rooms.set(baseId, {
                                id: baseId,
                                element: textEl,
                                x: x,
                                y: y
                            });
                        }
                    }
                });
            });

            // Categorize rooms
            const categories = {
                'Shop': [],
                'Food': [],
                'Building': [],
                'Other': []
            };

            rooms.forEach((room, id) => {
                // Simple categorization based on ID patterns
                if (id.includes('A') || id.includes('B') || id.includes('C')) {
                    categories['Shop'].push(room);
                } else if (parseInt(id.replace('ID', '')) >= 200) {
                    categories['Food'].push(room);
                } else if (parseInt(id.replace('ID', '')) >= 100) {
                    categories['Building'].push(room);
                } else {
                    categories['Other'].push(room);
                }
            });

            displayRooms(categories);
            updateStats(rooms.size);
        }

        // Display rooms in sidebar
        function displayRooms(categories) {
            const roomList = document.getElementById('roomList');
            roomList.innerHTML = '';

            Object.keys(categories).forEach(category => {
                if (categories[category].length === 0) return;

                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'room-category';

                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerHTML = `
                    <span>${getCategoryIcon(category)} ${category}</span>
                    <span class="arrow">‚ñ∂</span>
                `;

                const itemsDiv = document.createElement('div');
                itemsDiv.className = 'category-items';

                // Sort rooms by ID
                categories[category].sort((a, b) => a.id.localeCompare(b.id));

                categories[category].forEach(room => {
                    const item = document.createElement('div');
                    item.className = 'room-item';
                    item.textContent = room.id;
                    item.onclick = () => zoomToRoom(room);
                    itemsDiv.appendChild(item);
                });

                header.onclick = () => {
                    itemsDiv.classList.toggle('active');
                    header.querySelector('.arrow').classList.toggle('down');
                };

                categoryDiv.appendChild(header);
                categoryDiv.appendChild(itemsDiv);
                roomList.appendChild(categoryDiv);
            });
        }

        function getCategoryIcon(category) {
            const icons = {
                'Shop': 'üõçÔ∏è',
                'Food': 'üçΩÔ∏è',
                'Building': 'üè¢',
                'Other': 'üìç'
            };
            return icons[category] || 'üìç';
        }

        // Zoom to specific room
        function zoomToRoom(room) {
            if (!svgDoc) return;

            // Remove previous highlight
            if (selectedElement) {
                selectedElement.classList.remove('highlighted');
            }

            // Highlight selected room
            room.element.classList.add('highlighted');
            selectedElement = room.element;

            // Update selected item in list
            document.querySelectorAll('.room-item').forEach(item => {
                item.classList.remove('selected');
                if (item.textContent === room.id) {
                    item.classList.add('selected');
                }
            });

            // IMPORTANT: Completely reset transform and remove transition temporarily
            svgDoc.style.transition = 'none';
            currentZoom = 1;
            currentTranslate = { x: 0, y: 0 };
            svgDoc.style.transform = 'translate(0px, 0px) scale(1)';
            
            // Force a reflow to ensure the reset is applied
            void svgDoc.offsetHeight;

            // Wait for positions to stabilize
            setTimeout(() => {
                const container = document.getElementById('svgContainer');
                const containerRect = container.getBoundingClientRect();
                
                // Get the element's screen position AFTER reset
                const elementRect = room.element.getBoundingClientRect();
                
                // Element center in screen coordinates
                const elementCenterX = elementRect.left + elementRect.width / 2;
                const elementCenterY = elementRect.top + elementRect.height / 2;
                
                // Container center in screen coordinates
                const containerCenterX = containerRect.left + containerRect.width / 2;
                const containerCenterY = containerRect.top + containerRect.height / 2;
                
                // Calculate the difference
                const dx = elementCenterX - containerCenterX;
                const dy = elementCenterY - containerCenterY;
                
                // Target zoom level
                const targetZoom = 3;
                currentZoom = targetZoom;
                
                // Apply translation to center the element
                currentTranslate.x = -dx * targetZoom;
                currentTranslate.y = -dy * targetZoom;
                
                // Re-enable transition for smooth zoom
                svgDoc.style.transition = 'transform 0.3s ease';
                updateTransform();
                updateZoomLevel();
            }, 100);
        }

        // Setup pan and zoom
        function setupPanZoom() {
            const container = document.getElementById('svgContainer');

            container.addEventListener('mousedown', (e) => {
                isPanning = true;
                startPoint = { x: e.clientX - currentTranslate.x, y: e.clientY - currentTranslate.y };
                container.classList.add('grabbing');
            });

            container.addEventListener('mousemove', (e) => {
                if (!isPanning) return;
                currentTranslate.x = e.clientX - startPoint.x;
                currentTranslate.y = e.clientY - startPoint.y;
                updateTransform();
            });

            container.addEventListener('mouseup', () => {
                isPanning = false;
                container.classList.remove('grabbing');
            });

            container.addEventListener('mouseleave', () => {
                isPanning = false;
                container.classList.remove('grabbing');
            });

            // Zoom with mouse wheel
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                zoom(delta, e.clientX, e.clientY);
            });

            // Zoom buttons
            document.getElementById('zoomIn').onclick = () => zoom(1.2);
            document.getElementById('zoomOut').onclick = () => zoom(0.8);
            document.getElementById('resetZoom').onclick = resetZoom;
        }

        function zoom(factor, mouseX, mouseY) {
            const newZoom = currentZoom * factor;
            if (newZoom < 0.5 || newZoom > 10) return;

            if (mouseX !== undefined && mouseY !== undefined) {
                const container = document.getElementById('svgContainer');
                const rect = container.getBoundingClientRect();
                const offsetX = mouseX - rect.left;
                const offsetY = mouseY - rect.top;

                currentTranslate.x = offsetX - (offsetX - currentTranslate.x) * factor;
                currentTranslate.y = offsetY - (offsetY - currentTranslate.y) * factor;
            }

            currentZoom = newZoom;
            updateTransform();
            updateZoomLevel();
        }

        function resetZoom() {
            currentZoom = 1;
            currentTranslate = { x: 0, y: 0 };
            updateTransform();
            updateZoomLevel();
            
            if (selectedElement) {
                selectedElement.classList.remove('highlighted');
                selectedElement = null;
            }
            
            document.querySelectorAll('.room-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        function updateTransform() {
            if (!svgDoc) return;
            svgDoc.style.transform = `translate(${currentTranslate.x}px, ${currentTranslate.y}px) scale(${currentZoom})`;
        }

        function updateZoomLevel() {
            document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
        }

        function updateStats(total) {
            document.getElementById('totalRooms').textContent = total;
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('.room-item').forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Initialize
        loadSVG();
    </script>
</body>
</html>

